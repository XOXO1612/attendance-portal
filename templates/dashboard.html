<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Employee Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        .clock-box {
            background-color: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .indicator {
            height: 20px;
            width: 20px;
            border-radius: 50%;
            display: inline-block;
        }
        .green { background-color: green; }
        .red { background-color: red; }
    </style>
</head>
<body class="bg-light">
    <div class="container py-4">
        <h2 class="mb-4">Welcome, {{ current_user.username }}</h2>

        <!-- Live Clock Display -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="clock-box">
                    <h5>Total Logged-In Time</h5>
                    <div id="workTime">00:00:00</div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="clock-box">
                    <h5>Break Time</h5>
                    <div id="breakTime">00:00:00</div>
                    <span class="indicator" id="breakIndicator"></span>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="mb-4">
            <a href="{{ url_for('mark_attendance') }}" class="btn btn-success">Mark Attendance</a>
            <a href="{{ url_for('start_break') }}" class="btn btn-warning">Start Break</a>
            <a href="{{ url_for('end_break') }}" class="btn btn-danger">End Break</a>
            <a href="{{ url_for('punch_out') }}" class="btn btn-secondary">Punch Out</a>
        </div>

        <!-- Calendar View -->
        <h4>Attendance Calendar (This Month)</h4>
        <div class="row">
            {% for day in range(1, 32) %}
                <div class="col-1 p-1">
                    <div class="text-center {% if day in present_days %}bg-success text-white{% else %}bg-light{% endif %} rounded p-2">
                        {{ day }}
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

    <script>
        let startTime = new Date();
        let breakSeconds = 0;
        let onBreak = false;

        function updateTimers() {
            const now = new Date();
            let totalSeconds = Math.floor((now - startTime) / 1000);
            let workSeconds = totalSeconds - breakSeconds;

            document.getElementById("workTime").textContent = formatTime(workSeconds);
            document.getElementById("breakTime").textContent = formatTime(breakSeconds);

            document.getElementById("breakIndicator").className = "indicator " + (onBreak ? "red" : "green");
        }

        function formatTime(seconds) {
            const hrs = String(Math.floor(seconds / 3600)).padStart(2, '0');
            const mins = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
            const secs = String(seconds % 60).padStart(2, '0');
            return `${hrs}:${mins}:${secs}`;
        }

        setInterval(() => {
            if (onBreak) breakSeconds++;
            updateTimers();
        }, 1000);

        // Optionally detect break state from backend in future
    </script>
</body>
</html>
